# Discord Team Bot

Discord上でVCメンバーの鬼ごっこ・均等分割チーム分けができるBOTです。

## 機能

### 🏃‍♂️ 鬼ごっこモード（1vs4複数グループ）
- VCメンバーを5人ごとにグループ分けし、各グループで1人の鬼と4人の逃げる人を設定
- 複数の1vs4ゲームを同時開催可能
- 余ったメンバーは未割り当てとして表示

### ⚖️ 均等分割モード
- 指定した人数でチームを均等に分割
- 1チームあたり1〜10人まで設定可能

### 🎯 自動フィルタリング
- VCに参加している人のみを対象
- 名前が「👀観戦＠」で始まる人を自動除外
- BOTユーザーを自動除外

## コマンド一覧

### 📋 基本コマンド
| コマンド | 説明 |
|---------|------|
| `/teamstart [mode]` | チーム分けセッションを開始 |
| `/mode <type>` | モード切り替え（tag/equal） |
| `/teamend` | セッション終了 |
| `/refresh` | VCメンバーを再取得 |

### 👹 鬼ごっこモード専用
| コマンド | 説明 |
|---------|------|
| `/addoni <user>` | 鬼候補者に追加 |
| `/removeoni <user>` | 鬼候補者から削除 |
| `/clearoni` | 鬼候補者リストをクリア |
| `/randomoni` | 鬼候補者を考慮して全グループに鬼を配置 |

### ⚖️ 均等分割モード専用
| コマンド | 説明 |
|---------|------|
| `/setsize <size>` | 1チームあたりの人数を設定（1-10人） |

### 🎲 共通機能
| コマンド | 説明 |
|---------|------|
| `/shuffle` | 現在のモードでランダム再分割 |
| `/addmember <user>` | VCに入っていない人を手動追加 |
| `/removemember <user>` | 参加者から削除 |

### 🔘 ボタン操作
| ボタン | 説明 | 権限 |
|--------|------|------|
| 🙋‍♂️ 鬼立候補 | 鬼候補者への追加/削除（トグル式） | 参加者なら誰でも |
| ⚖️/🏃‍♂️ モード切替 | 鬼ごっこ⇔均等分割モードの切り替え | 作成者のみ |
| 🗑️ 鬼候補クリア | 鬼候補者リストを一括クリア | 作成者のみ |
| 👥 チーム人数変更 | 均等分割のチーム人数変更（1-10人） | 作成者のみ |
| 🎲 シャッフル | チーム分けをシャッフル実行 | 作成者のみ |

### 🎯 ユーティリティ
| コマンド | 説明 |
|---------|------|
| `/help` | コマンド一覧表示 |
| `/dice` | サイコロ |
| `/ccb` | クトゥルフ神話TRPG用ダイス |

## 使い方

### 鬼ごっこゲームの場合（1vs4複数グループ）
1. VCに参加（最低5人、推奨10人以上）
2. `/teamstart tag` でセッション開始
3. 🙋‍♂️ボタンで鬼候補者を設定（参加者が自分で押す）
4. 🎲ボタンまたは`/randomoni`で鬼を配置
5. 必要に応じて🎲ボタンで再シャッフル
6. `/teamend` でセッション終了

**例:** 20人の場合 → 4グループ作成（各グループ鬼1人+逃げる人4人）

### 均等分割の場合
1. VCに参加
2. `/teamstart equal` でセッション開始
3. 👥ボタンまたは`/setsize 4`でチーム人数設定（例：4人）
4. 🎲ボタンまたは`/shuffle`でメンバーをランダム分割
5. `/teamend` でセッション終了

### ボタン操作による簡単操作
- **鬼立候補**: 🙋‍♂️ボタンを押すだけで鬼候補者に追加/削除
- **モード切替**: ⚖️/🏃‍♂️ボタンでワンクリック切り替え
- **チーム人数変更**: 👥ボタンから1-10人を選択
- **シャッフル**: 🎲ボタンでワンクリック実行
- **鬼候補クリア**: 🗑️ボタンで一括削除

## セットアップ

### 必要環境
- Node.js 16.x以上
- Discord.js v14

### インストール
```bash
npm install
```

### 設定
`config.json`ファイルを作成し、以下の内容を記入：
```json
{
  "token": "YOUR_BOT_TOKEN",
  "guildId": "YOUR_GUILD_ID"
}
```

### 実行
```bash
npm start
```
または
```bash
node index.js
```

## BOT権限

BOTには以下の権限が必要です：
- `Send Messages` - メッセージ送信
- `Use Slash Commands` - スラッシュコマンド使用
- `Read Message History` - メッセージ履歴の読み取り
- `Connect` - ボイスチャンネル情報の取得

## 注意事項

- BOTを使用するユーザーがVCに参加している必要があります
- 名前の先頭に「👀観戦＠」がついているユーザーは自動的に除外されます
- BOTユーザーは自動的に除外されます
- セッションはチャンネルごとに管理されます

## 更新履歴

### v3.0.0
- **ボタン操作追加**: 直感的なUI操作が可能に
- **鬼候補者システム**: 事前に鬼になりたい人を設定可能
- **手動メンバー管理**: VCに入っていない人も参加可能
- **権限制御**: セッション作成者と参加者で操作権限を分離
- **一時メッセージ自動削除**: 5秒後に応答メッセージが自動削除
- **操作性大幅向上**: ボタンとセレクトメニューによる簡単操作

### v2.0.0
- 鬼ごっこモード（1vs4複数グループ）追加
- 均等分割モード追加
- 自動フィルタリング機能追加
- UI/UX大幅改善
- 強さ均一化機能を廃止

### v1.0.0
- 初期リリース
- 基本的なチーム分け機能

## 作者

Created by: altivelis

## ライセンス

ISC License
